---
layout: post
title: https密钥交换过程
date: 2021-04-22 11:45:53
tags:
---
# 关键点
 - 使用 **非对称加密** 处理用于加密数据的密钥

 - 使用 **对称加密** 处理具体的数据

# 图解
[流程图地址，按需自取](https://drive.google.com/file/d/14vRn_mfvbyN8-JSvktHqMN25kxAl4W_s/view)

<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="581px" height="710px" viewBox="-0.5 -0.5 581 710" content="&lt;mxfile host=&quot;app.diagrams.net&quot; modified=&quot;2021-04-22T03:28:40.734Z&quot; agent=&quot;5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.72 Safari/537.36&quot; etag=&quot;r0FVoIzRprTmziIPNl1Z&quot; version=&quot;14.6.5&quot; type=&quot;google&quot;&gt;&lt;diagram id=&quot;BLMGk-S4g4146bWGQgA-&quot; name=&quot;Page-1&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;" style="background-color: rgb(255, 255, 255);"><defs/><g><rect x="70" y="30" width="160" height="670" fill="#d5e8d4" stroke="#82b366" pointer-events="all"/><rect x="430" y="30" width="150" height="670" fill="#e1d5e7" stroke="#9673a6" pointer-events="all"/><rect x="130" y="0" width="40" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 38px; height: 1px; padding-top: 10px; margin-left: 131px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font style="font-size: 14px">Client</font></div></div></div></foreignObject><text x="150" y="14" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Client</text></switch></g><rect x="480" y="0" width="40" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 38px; height: 1px; padding-top: 10px; margin-left: 481px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font style="font-size: 14px">Server</font></div></div></div></foreignObject><text x="500" y="14" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Server</text></switch></g><path d="M 220 70 L 433.63 65.14" fill="none" stroke="#000000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 438.88 65.03 L 431.96 68.68 L 433.63 65.14 L 431.8 61.69 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 68px; margin-left: 324px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; "><font style="font-size: 12px">请求publicKey</font></div></div></div></foreignObject><text x="324" y="71" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">请求publicKey</text></switch></g><rect x="80" y="40" width="140" height="60" rx="9" ry="9" fill="#fff2cc" stroke="#d6b656" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 138px; height: 1px; padding-top: 70px; margin-left: 81px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">发起请求</div></div></div></foreignObject><text x="150" y="74" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">发起请求</text></switch></g><path d="M 30 30 L 30 691.76" fill="none" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 30 697.76 L 26 689.76 L 30 691.76 L 34 689.76 Z" fill="#000000" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 249px; margin-left: 31px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 13px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; font-weight: bold; background-color: #ffffff; white-space: nowrap; ">Time Line</div></div></div></foreignObject><text x="31" y="252" fill="#000000" font-family="Helvetica" font-size="13px" text-anchor="middle" font-weight="bold">Time Line</text></switch></g><rect x="440" y="40" width="130" height="50" rx="7.5" ry="7.5" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 128px; height: 1px; padding-top: 65px; margin-left: 441px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">处理请求返回公钥:publicKey</div></div></div></foreignObject><text x="505" y="69" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">处理请求返回公钥:publicKey</text></switch></g><path d="M 437.79 83.55 L 225.51 206.8" fill="none" stroke="#000000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 220.97 209.44 L 225.26 202.9 L 225.51 206.8 L 228.78 208.95 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 147px; margin-left: 329px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; "><span style="font-size: 12px ; background-color: rgb(248 , 249 , 250)">返回publicKey</span></div></div></div></foreignObject><text x="329" y="150" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">返回publicKey</text></switch></g><rect x="80" y="130" width="140" height="160" fill="#fff2cc" stroke="#d6b656" pointer-events="all"/><rect x="80" y="130" width="110" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 108px; height: 1px; padding-top: 140px; margin-left: 81px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">验证公钥合法性</div></div></div></foreignObject><text x="135" y="144" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">验证公钥合法性</text></switch></g><path d="M 145 190 L 145 210 L 145 190 L 145 203.63" fill="none" stroke="#000000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 145 208.88 L 141.5 201.88 L 145 203.63 L 148.5 201.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="145" cy="175" rx="45" ry="15" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 88px; height: 1px; padding-top: 175px; margin-left: 101px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font style="font-size: 10px">使用CA验证公钥</font></div></div></div></foreignObject><text x="145" y="179" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">使用CA验证公钥</text></switch></g><path d="M 145 260 L 145 285 L 144 285 L 143.99 303.63" fill="none" stroke="#000000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 143.98 308.88 L 140.49 301.88 L 143.99 303.63 L 147.49 301.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 276px; margin-left: 146px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">Y</div></div></div></foreignObject><text x="146" y="279" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">Y</text></switch></g><path d="M 190 235 L 243.63 235" fill="none" stroke="#000000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 248.88 235 L 241.88 238.5 L 243.63 235 L 241.88 231.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 235px; margin-left: 208px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">N</div></div></div></foreignObject><text x="208" y="238" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">N</text></switch></g><path d="M 145 210 L 190 235 L 145 260 L 100 235 Z" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 88px; height: 1px; padding-top: 235px; margin-left: 101px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">是否合法</div></div></div></foreignObject><text x="145" y="239" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">是否合法</text></switch></g><rect x="80" y="310" width="140" height="110" fill="#fff2cc" stroke="#d6b656" pointer-events="all"/><ellipse cx="287.5" cy="235" rx="37.5" ry="27.5" fill="#ffe6cc" stroke="#d79b00" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 73px; height: 1px; padding-top: 235px; margin-left: 251px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">结束</div></div></div></foreignObject><text x="288" y="239" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">结束</text></switch></g><rect x="60" y="310" width="180" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 178px; height: 1px; padding-top: 320px; margin-left: 61px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">生成随机密钥:randomKey</div></div></div></foreignObject><text x="150" y="324" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">生成随机密钥:randomKey</text></switch></g><rect x="90" y="330" width="120" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 360px; margin-left: 91px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 13px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><span style="color: rgb(0 , 0 , 0) ; font-family: &quot;helvetica&quot; ; font-size: 10px ; font-style: normal ; font-weight: 400 ; letter-spacing: normal ; text-align: center ; text-indent: 0px ; text-transform: none ; word-spacing: 0px ; background-color: rgb(248 , 249 , 250) ; display: inline ; float: none">使用publicKey加密randomKey得到：<br />encryptRandomKey<br /></span></div></div></div></foreignObject><text x="150" y="364" fill="#000000" font-family="Helvetica" font-size="13px" text-anchor="middle">使用publicKey加密randomKey...</text></switch></g><path d="M 210 360 L 434.3 247.85" fill="none" stroke="#000000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 439 245.5 L 434.3 251.76 L 434.3 247.85 L 431.17 245.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 302px; margin-left: 325px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; "><span style="font-size: 12px ; background-color: rgb(248 , 249 , 250)">发送encryptRandomKey</span></div></div></div></foreignObject><text x="325" y="306" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">发送encryptRan...</text></switch></g><path d="M 505 310 L 505 330 L 505 310 L 505 323.63" fill="none" stroke="#000000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 505 328.88 L 501.5 321.88 L 505 323.63 L 508.5 321.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="440" y="180" width="130" height="130" fill="#dae8fc" stroke="#6c8ebf" pointer-events="all"/><rect x="450" y="187.5" width="90" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 88px; height: 1px; padding-top: 198px; margin-left: 451px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 13px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font style="font-size: 12px">获取randomKey</font></div></div></div></foreignObject><text x="495" y="201" fill="#000000" font-family="Helvetica" font-size="13px" text-anchor="middle">获取randomKey</text></switch></g><rect x="445" y="210" width="120" height="80" rx="12" ry="12" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 250px; margin-left: 446px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 13px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">使用<font color="#ff3333">私钥解密</font><br /><span style="font-size: 12px">encryptRandomKey<br />得到：</span><span style="font-size: 12px">randomKey</span><span style="font-size: 12px"><br /></span></div></div></div></foreignObject><text x="505" y="254" fill="#000000" font-family="Helvetica" font-size="13px" text-anchor="middle">使用私钥解密encryptRandomKey...</text></switch></g><rect x="440" y="330" width="130" height="130" fill="#dae8fc" stroke="#6c8ebf" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 128px; height: 1px; padding-top: 395px; margin-left: 441px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">使用randomKey加密要传输的业务数据data</div></div></div></foreignObject><text x="505" y="399" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">使用randomKey加密要传输的业务数据data</text></switch></g><rect x="80" y="440" width="140" height="120" fill="#fff2cc" stroke="#d6b656" pointer-events="all"/><rect x="80" y="450" width="70" height="20" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 68px; height: 1px; padding-top: 460px; margin-left: 81px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 13px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><font style="font-size: 11px">解密数据</font></div></div></div></foreignObject><text x="115" y="464" fill="#000000" font-family="Helvetica" font-size="13px" text-anchor="middle">解密数据</text></switch></g><rect x="90" y="480" width="120" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 510px; margin-left: 91px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 13px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><span style="color: rgb(0 , 0 , 0) ; font-family: &quot;helvetica&quot; ; font-size: 10px ; font-style: normal ; font-weight: 400 ; letter-spacing: normal ; text-align: center ; text-indent: 0px ; text-transform: none ; word-spacing: 0px ; background-color: rgb(248 , 249 , 250) ; display: inline ; float: none">使用randomKey解密密文，得到明文<br /></span></div></div></div></foreignObject><text x="150" y="514" fill="#000000" font-family="Helvetica" font-size="13px" text-anchor="middle">使用randomKey解密密文，得到明文&#xa;</text></switch></g><path d="M 440 395 L 215.92 483.86" fill="none" stroke="#000000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 211.04 485.79 L 216.26 479.96 L 215.92 483.86 L 218.84 486.47 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 440px; margin-left: 330px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; "><span style="font-size: 12px ; background-color: rgb(248 , 249 , 250)">发送data</span></div></div></div></foreignObject><text x="330" y="443" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">发送data</text></switch></g><ellipse cx="150" cy="620" rx="60" ry="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 620px; margin-left: 91px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 13px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">后续请求使用randomKey加密/解密数据</div></div></div></foreignObject><text x="150" y="624" fill="#000000" font-family="Helvetica" font-size="13px" text-anchor="middle">后续请求使用randomKey加密/解密数据</text></switch></g><path d="M 192.43 591.72 L 461.21 581.95" fill="none" stroke="#000000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 466.46 581.76 L 459.59 585.51 L 461.21 581.95 L 459.33 578.51 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 585px; margin-left: 323px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 13px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">Request</div></div></div></foreignObject><text x="323" y="589" fill="#000000" font-family="Helvetica" font-size="13px" text-anchor="middle">Request</text></switch></g><ellipse cx="510" cy="610" rx="60" ry="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 610px; margin-left: 451px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 13px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">后续请求使用randomKey加密/解密数据</div></div></div></foreignObject><text x="510" y="614" fill="#000000" font-family="Helvetica" font-size="13px" text-anchor="middle">后续请求使用randomKey加密/解密数据</text></switch></g><path d="M 467.57 638.28 L 198.79 648.05" fill="none" stroke="#000000" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"/><path d="M 193.54 648.24 L 200.41 644.49 L 198.79 648.05 L 200.67 651.49 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 643px; margin-left: 324px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 13px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">Response</div></div></div></foreignObject><text x="324" y="647" fill="#000000" font-family="Helvetica" font-size="13px" text-anchor="middle">Response</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg>

# 流程说明

## 1.客户端获取公钥

- 客户端发送请求，服务端返回公钥

- 客户端用证书验证公钥，如果合法，继续下一步

## 2.客户端生成用于加密数据的密钥
- 客户端生成随机密钥
- 然后用服务器返回的公钥对这个密钥加密，得到加密后的密钥

## 3.服务端验证密钥
- 客户端将加密后的密钥发给服务端
- 服务端使用私钥解密得到密钥

## 4.使用密钥加密数据进行传输，使用密钥解密数据得到明文
- 服务端使用获得的密钥加密数据，发送给客户端
- 客户端使用密钥解密得到明文。

